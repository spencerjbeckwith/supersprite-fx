class e{constructor(e,t,i,r){this.red=e,this.green=t,this.blue=i,this.alpha=void 0===r?1:r}invert(){return new e(1-this.red,1-this.green,1-this.blue,this.alpha)}}e.fromHex=function(t,i){if(6!==(t=t.replace("#","")).length)throw new Error("Color.fromHex requires a six-digit hex color.");return new e(parseInt(t[0]+t[1],16)/255,parseInt(t[2]+t[3],16)/255,parseInt(t[4]+t[5],16)/255,i)},e.toHex=function(e){const t=Math.round(255*e.red).toString(16),i=Math.round(255*e.green).toString(16),r=Math.round(255*e.blue).toString(16);return`#${t.length<2?"0":""}${t}${i.length<2?"0":""}${i}${r.length<2?"0":""}${r}`};class t{constructor(e){this.values=e}copy(){return new t([...this.values])}multiply(e){const t=this.values[0],i=this.values[1],r=this.values[2],n=this.values[3],o=this.values[4],a=this.values[5],s=this.values[6],u=this.values[7],l=this.values[8],c=e.values[0],d=e.values[1],m=e.values[2],h=e.values[3],f=e.values[4],x=e.values[5],v=e.values[6],p=e.values[7],g=e.values[8];return this.values=[c*t+d*n+m*s,c*i+d*o+m*u,c*r+d*a+m*l,h*t+f*n+x*s,h*i+f*o+x*u,h*r+f*a+x*l,v*t+p*n+g*s,v*i+p*o+g*u,v*r+p*a+g*l],this}translate(e,i){return this.multiply(new t([1,0,0,0,1,0,e,i,1]))}rotate(e){const i=Math.cos(e),r=Math.sin(e);return this.multiply(new t([i,-r,0,r,i,0,0,0,1]))}scale(e,i){return this.multiply(new t([e,0,0,0,i,0,0,0,1]))}}t.projection=function(e,i){return new t([2/e,0,0,0,2/i,0,-1,-1,1])},t.identity=[1,0,0,0,1,0,0,0,1];const i={source:{vertex:"#version 300 es\nin vec2 a_position;\nin vec2 a_texcoord;\nout vec2 v_texcoord;\nuniform mat3 u_positionMatrix;\nuniform mat3 u_textureMatrix;\n\nvoid main() {\n    gl_Position = vec4( (u_positionMatrix * vec3(a_position, 1.0) ).xy, 0, 1);\n    v_texcoord = ( u_textureMatrix * vec3(a_texcoord, 1.0) ).xy;\n}",fragment:"#version 300 es\nprecision mediump float;\nin vec2 v_texcoord;\nout vec4 outputColor;\nuniform sampler2D u_atlas;\nuniform vec4 u_blend;\n\nuniform int u_useTexture;\n\nvoid main() {\n    if (u_useTexture == 0) {\n        outputColor = u_blend;\n    } else {\n        outputColor = texture(u_atlas, v_texcoord) * u_blend;\n    }\n}"},attributes:{position:"a_position",texture:"a_texcoord"},uniforms:{positionMatrix:"u_positionMatrix",textureMatrix:"u_textureMatrix",atlas:"u_atlas",blend:"u_blend",useTexture:"u_useTexture"}};function r(i,r,n,o,a){function s(t,r){n.setPositions(t),n.setUVs(t),i.uniformMatrix3fv(n.uniforms.positionMatrix,!1,o.values),i.uniform1i(n.uniforms.useTexture,0),r instanceof e?i.uniform4f(n.uniforms.blend,r.red,r.green,r.blue,r.alpha):i.uniform4f(n.uniforms.blend,void 0===r[0]?1:r[0],void 0===r[1]?1:r[1],void 0===r[2]?1:r[2],void 0===r[3]?1:r[3])}function u(e,t){return t=Math.floor(t),e.images[t]||(t%=e.images.length),t}function l(e,t){return a.current*t%e.images.length}function c(t,r,o,a,s,l){r=u(t,r);let c=this.projection.copy().translate(o,a).scale(t.width,t.height);s&&(c=s(c)),0===t.originX&&0===t.originY||c.translate(-t.originX/t.width,-t.originY/t.height),i.bindTexture(i.TEXTURE_2D,this.atlasTexture),i.bindVertexArray(n.vao),i.uniformMatrix3fv(n.uniforms.positionMatrix,!1,c.values),i.uniformMatrix3fv(n.uniforms.textureMatrix,!1,t.images[r].t),i.uniform1i(n.uniforms.useTexture,1),l instanceof e?i.uniform4f(n.uniforms.blend,l.red,l.green,l.blue,l.alpha):l instanceof Array?i.uniform4f(n.uniforms.blend,void 0===l[0]?1:l[0],void 0===l[1]?1:l[1],void 0===l[2]?1:l[2],void 0===l[3]?1:l[3]):i.uniform4f(n.uniforms.blend,1,1,1,1),i.drawArrays(i.TRIANGLES,0,6),i.bindVertexArray(null)}function d(t,r,o,a,s,l,c,d){r=u(t,r);let m=this.projection.copy().translate(o,a).scale(t.width,t.height);c&&(m=c(m)),0===t.originX&&0===t.originY||m.translate(-t.originX/t.width,-t.originY/t.height),i.bindTexture(i.TEXTURE_2D,this.atlasTexture),n.setPositions(s),n.setUVs(l),i.uniformMatrix3fv(n.uniforms.positionMatrix,!1,m.values),i.uniformMatrix3fv(n.uniforms.textureMatrix,!1,t.images[r].t),i.uniform1i(n.uniforms.useTexture,1),d instanceof e?i.uniform4f(n.uniforms.blend,d.red,d.green,d.blue,d.alpha):d instanceof Array?i.uniform4f(n.uniforms.blend,void 0===d[0]?1:d[0],void 0===d[1]?1:d[1],void 0===d[2]?1:d[2],void 0===d[3]?1:d[3]):i.uniform4f(n.uniforms.blend,1,1,1,1),i.drawArrays(i.TRIANGLES,0,Math.floor(s.length/2))}function m(e,t,i,n,o=1,a=1){if(this.atlasImage){t=u(e,t);const s=e.images[t];r.drawImage(this.atlasImage,s.x,s.y,e.width,e.height,i-e.originX,n-e.originY,e.width*o,e.height*a)}}function h(e,t,i,n){r.textAlign=(null==n?void 0:n.hAlign)||"left",r.textBaseline=(null==n?void 0:n.vAlign)||"top",r.font=`${(null==n?void 0:n.fontSize)||10}px ${(null==n?void 0:n.fontName)||"sans-serif"}`,(null==n?void 0:n.drawShadow)&&(r.fillStyle="black",r.fillText(i,e+(void 0===n.shadowOffsetX?1:n.shadowOffsetX),t+(void 0===n.shadowOffsetY?1:n.shadowOffsetY),n.maxWidth)),r.fillStyle=(null==n?void 0:n.color)||"white",r.fillText(i,e,t,null==n?void 0:n.maxWidth)}return{atlasTexture:null,atlasImage:null,projection:o,sprite:c,spriteSpecial:d,spriteCtx:m,text:h,line:function(e,t,r,n,o){s([e,t,r,n],o),i.drawArrays(i.LINES,0,2)},rect:function(e,t,r,n,o){s([e,t,e,n,r,n,r,n,r,t,e,t],o),i.drawArrays(i.TRIANGLES,0,6)},circle:function(e,t,r,n,o){const a=[e,t];let u=0;for(let i=0;i<=n;i++)a.push(e+r*Math.cos(u)),a.push(t+r*Math.sin(u)),u+=2*Math.PI/n;s(a,o),i.drawArrays(i.TRIANGLE_FAN,0,n+2)},primitive:function(e,t,r){let n=i.TRIANGLES;switch(e){case"points":n=i.POINTS;break;case"lineStrip":n=i.LINE_STRIP;break;case"lineLoop":n=i.LINE_LOOP;break;case"lines":n=i.LINES;break;case"triangleStrip":n=i.TRIANGLE_STRIP;break;case"triangleFan":n=i.TRIANGLE_FAN;break;case"triangles":n=i.TRIANGLES}s(t,r),i.drawArrays(n,0,t.length/2)},spriteSpeed:function(e,t,i,r,n,o){c.bind(this)(e,l(e,t),i,r,n,o)},spriteSpeedSpecial:function(e,t,i,r,n,o,a,s){d.bind(this)(e,l(e,t),i,r,n,o,a,s)},spriteSpeedCtx:function(e,t,i,r,n=1,o=1){m.bind(this)(e,l(e,t),i,r,n,o)},texture:function(r,o,a,s,u,l,c,d,m){i.bindTexture(i.TEXTURE_2D,r),n.setPositions(l),n.setUVs(c);let h=this.projection.copy().translate(o,a).scale(s,u);d&&(h=d(h)),i.uniformMatrix3fv(n.uniforms.positionMatrix,!1,h.values),i.uniformMatrix3fv(n.uniforms.textureMatrix,!1,t.identity),i.uniform4f(n.uniforms.blend,1,1,1,1),i.uniform1i(n.uniforms.useTexture,1),m instanceof e?i.uniform4f(n.uniforms.blend,m.red,m.green,m.blue,m.alpha):m instanceof Array?i.uniform4f(n.uniforms.blend,void 0===m[0]?1:m[0],void 0===m[1]?1:m[1],void 0===m[2]?1:m[2],void 0===m[3]?1:m[3]):i.uniform4f(n.uniforms.blend,1,1,1,1),i.drawArrays(i.TRIANGLES,0,l.length/2),i.bindTexture(i.TEXTURE_2D,this.atlasTexture)},textWrap:function(e,t,i,n,o){const a=[];let s=0,u=0,l="";for(;s<=i.length;){const e=i.charAt(s);if(""===e){a[u]=l;break}r.measureText(l).width>n&&e.match((null==o?void 0:o.lineBreakCharacters)||/ |\/|\\|-/g)?(" "!==e&&(l+=e),a[u]=l,u++,l=""):l+=e,s++}let c=t;"middle"===(null==o?void 0:o.vAlign)?c=t-(a.length-1)*(o.lineSeparation||16)/2:"bottom"===(null==o?void 0:o.vAlign)&&(c=t-(a.length-1)*(o.lineSeparation||16));for(let t=0;t<a.length;t++)h(e,c+t*((null==o?void 0:o.lineSeparation)||16),a[t],o)}}}function n(n){const o=document.createElement("canvas"),a=document.createElement("canvas");o.setAttribute("style","position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); overflow: hidden;"),a.setAttribute("style","position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); overflow: hidden;"),document.body.style.backgroundColor="#000000",document.body.appendChild(o),document.body.appendChild(a),o.width=(null==n?void 0:n.displayWidth)||(null==n?void 0:n.viewWidth)||window.innerWidth,o.height=(null==n?void 0:n.displayHeight)||(null==n?void 0:n.viewHeight)||window.innerHeight,a.width=o.width,a.height=o.height;const s=o.getContext("webgl2",null==n?void 0:n.glOptions);if(!s)throw new Error("Failed to initialize WebGL context!");const u=a.getContext("2d",null==n?void 0:n.ctxOptions);if(!u)throw new Error("Failed to initialize 2D canvas context!");const l=function(e,t){function r(t,i){const r=e.createShader(t);if(!r)throw new Error("Failed to create shader!");if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(r);throw e.deleteShader(r),new Error(`Failed to compile shader: ${t}`)}return r}const n=r(e.VERTEX_SHADER,t?t.source.vertex:i.source.vertex),o=r(e.FRAGMENT_SHADER,t?t.source.fragment:i.source.fragment),a=e.createProgram();if(!a)throw new Error("Failed to create WebGL program!");if(e.attachShader(a,n),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error(`Failed to link shader program: ${e.getProgramInfoLog(a)}`);const s=e.createBuffer(),u=e.createBuffer(),l=e.createBuffer();if(!s||!u||!l)throw new Error("Failed to create required WebGL buffers!");const c=e.getAttribLocation(a,t?t.attributes.position:i.attributes.position),d=e.getAttribLocation(a,t?t.attributes.texture:i.attributes.texture),m=e.getUniformLocation(a,t?t.uniforms.positionMatrix:i.uniforms.positionMatrix);if(!m)throw new Error("Failed to find position matrix uniform!");const h=e.getUniformLocation(a,t?t.uniforms.textureMatrix:i.uniforms.textureMatrix);if(!h)throw new Error("Failed to find texture matrix uniform!");const f=e.getUniformLocation(a,t?t.uniforms.atlas:i.uniforms.atlas);if(!f)throw new Error("Failed to find atlas sampler uniform!");const x=e.getUniformLocation(a,t?t.uniforms.blend:i.uniforms.blend);if(!x)throw new Error("Failed to find blend uniform!");const v=e.getUniformLocation(a,t?t.uniforms.useTexture:i.uniforms.useTexture);if(!v)throw new Error("Failed to find useTexture uniform!");e.useProgram(a);const p=e.createVertexArray();if(!p)throw new Error("Failed to create new vertex array!");e.bindVertexArray(p);const g=[0,0,0,1,1,1,1,1,1,0,0,0];return e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array(g),e.STATIC_DRAW),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(d),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0),e.bindVertexArray(null),{vertex:n,fragment:o,program:a,vao:p,buffers:{square:s,position:u,texture:l},attributes:{position:c,texture:d},uniforms:{positionMatrix:m,textureMatrix:h,atlasSampler:f,blend:x,useTexture:v},createShader:r,setPositions:function(t=g){e.enableVertexAttribArray(c),e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.DYNAMIC_DRAW),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0)},setUVs:function(t=g){e.enableVertexAttribArray(d),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.DYNAMIC_DRAW),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0)}}}(s,null==n?void 0:n.mainShaderOptions);function c(e){switch(e){case"linear":return null==s?void 0:s.LINEAR;case"nearest":return null==s?void 0:s.NEAREST;case"nearestMipmapNearest":return null==s?void 0:s.NEAREST_MIPMAP_NEAREST;case"linearMipmapNearest":return null==s?void 0:s.LINEAR_MIPMAP_NEAREST;case"nearestMipmapLinear":return null==s?void 0:s.NEAREST_MIPMAP_LINEAR;case"linearMipmapLinear":return null==s?void 0:s.LINEAR_MIPMAP_LINEAR;case"repeat":return null==s?void 0:s.REPEAT;case"clampToEdge":return null==s?void 0:s.CLAMP_TO_EDGE;case"mirroredRepeat":return null==s?void 0:s.MIRRORED_REPEAT}}const d=s.createTexture();if(!d)throw new Error("Failed to create gameTexture!");s.bindTexture(s.TEXTURE_2D,d),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,400,240,0,s.RGBA,s.UNSIGNED_BYTE,null),(null==n?void 0:n.gameTextureParameters)?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,c(n.gameTextureParameters.textureMagFilter||"linear")||s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,c(n.gameTextureParameters.textureMinFilter||"linear")||s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,c(n.gameTextureParameters.textureWrapS||"repeat")||s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,c(n.gameTextureParameters.textureWrapT||"repeat")||s.REPEAT)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT));const m=new t([2,0,0,0,-2,0,-1,1,1]),h=new t([1,0,0,0,1,0,0,0,1]),f=s.createFramebuffer();if(!f)throw new Error("Failed to create framebuffer!");s.bindFramebuffer(s.FRAMEBUFFER,f),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,d,0),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA);const x=t.projection(400,240),v={current:0},p={cv1:o,cv2:a,atlasImage:null,gl:s,ctx:u,main:l,gameTexture:d,atlasTexture:null,framebuffer:f,draw:r(s,u,l,x,v),projection:x,viewWidth:400,viewHeight:240,displayWidth:400,displayHeight:240,internalTimer:v,background:{red:0,green:0,blue:0},blend:[1,1,1,1],options:{responsive:(null==n?void 0:n.responsive)?n.responsive:"scale",maintainAspectRatio:!(null==n?void 0:n.maintainAspectRatio)||n.maintainAspectRatio,scalePerfectly:!(null==n?void 0:n.scalePerfectly)||n.scalePerfectly,contextImageSmoothing:!!(null==n?void 0:n.contextImageSmoothing)&&n.contextImageSmoothing,matchPageToBackground:!!(null==n?void 0:n.matchPageToBackground)&&n.matchPageToBackground,enableCanvasResize:!(null==n?void 0:n.enableCanvasResize)||n.enableCanvasResize},setAtlas:function(e){this.atlasTexture=e.texture,this.atlasImage=e.image,this.draw.atlasTexture=this.atlasTexture,this.draw.atlasImage=this.atlasImage,s.uniform1i(l.uniforms.atlasSampler,0),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.atlasTexture)},setProjection:function(e,i,r,n){this.viewWidth=e,this.viewHeight=i,this.displayWidth=r||e,this.displayHeight=n||i,this.projection=t.projection(this.viewWidth,this.viewHeight),this.draw.projection=this.projection,this.cv1.width=r||e,this.cv1.height=n||i,this.cv2.width=this.cv1.width,this.cv2.height=this.cv1.height,s.bindTexture(s.TEXTURE_2D,this.gameTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.viewWidth,this.viewHeight,0,s.RGBA,s.UNSIGNED_BYTE,null),u.imageSmoothingEnabled=this.options.contextImageSmoothing,u.setTransform(1,0,0,1,0,0),u.scale(this.displayWidth/this.viewWidth,this.displayHeight/this.viewHeight)},beginRender:function(){this.options.matchPageToBackground&&(document.body.style.backgroundColor=e.toHex(new e(this.background.red,this.background.green,this.background.blue))),s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffer),s.viewport(0,0,this.viewWidth,this.viewHeight),s.clearColor(this.background.red,this.background.green,this.background.blue,1),s.clear(s.COLOR_BUFFER_BIT),u.clearRect(0,0,this.viewWidth,this.viewHeight),this.atlasTexture&&s.bindTexture(s.TEXTURE_2D,this.atlasTexture),s.uniform4f(this.main.uniforms.blend,1,1,1,1),this.internalTimer.current++,this.internalTimer.current>4096&&(this.internalTimer.current=0)},endRender:function(t,i,r){s.bindFramebuffer(s.FRAMEBUFFER,null),s.viewport(0,0,this.displayWidth,this.displayHeight),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),s.bindTexture(s.TEXTURE_2D,this.gameTexture),l.setPositions(i),l.setUVs(r);let n=m;t&&(n=m.copy(),n=t(n)),s.uniformMatrix3fv(l.uniforms.positionMatrix,!1,n.values),s.uniformMatrix3fv(l.uniforms.textureMatrix,!1,h.values),this.blend instanceof e?s.uniform4fv(l.uniforms.blend,[this.blend.red,this.blend.green,this.blend.blue,this.blend.alpha||1]):s.uniform4fv(l.uniforms.blend,this.blend),s.uniform1i(l.uniforms.useTexture,1),s.drawArrays(s.TRIANGLES,0,i?i.length/2:6)},loadTexture:function(e,t){return new Promise(((i,r)=>{const n=s.createTexture();if(!n)throw new Error("Failed to create WebGLTexture!");s.bindTexture(s.TEXTURE_2D,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,c((null==t?void 0:t.textureMagFilter)||"linear")||s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,c((null==t?void 0:t.textureMinFilter)||"linear")||s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,c((null==t?void 0:t.textureWrapS)||"repeat")||s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,c((null==t?void 0:t.textureWrapT)||"repeat")||s.REPEAT);const o=new Image;o.src=e,o.addEventListener("load",(()=>{s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,o),i({image:o,texture:n,width:o.width,height:o.height})})),o.addEventListener("error",r),o.addEventListener("abort",r)}))},resizeCanvas:function(){switch(this.options.responsive){case"stretch":if(this.options.maintainAspectRatio){const e=this.viewWidth/this.viewHeight;let t=this.viewWidth,i=this.viewHeight;window.innerWidth>window.innerHeight?(t=i*e,i=window.innerHeight):(t=window.innerWidth,i=t/e),this.setProjection(t,i)}else this.setProjection(window.innerWidth,window.innerHeight);break;case"scale":if(this.options.maintainAspectRatio){let e=1;e=window.innerWidth>window.innerHeight?window.innerHeight/this.viewHeight:window.innerWidth/this.viewWidth,e=Math.max(e,1),this.options.scalePerfectly&&(e=Math.floor(e)),this.setProjection(this.viewWidth,this.viewHeight,this.viewWidth*e,this.viewHeight*e)}else this.setProjection(this.viewWidth,this.viewHeight,window.innerWidth,window.innerHeight)}}};return p.ctx.imageSmoothingEnabled=p.options.contextImageSmoothing,p.setProjection((null==n?void 0:n.viewWidth)||p.viewWidth,(null==n?void 0:n.viewHeight)||p.viewHeight,null==n?void 0:n.displayWidth,null==n?void 0:n.displayHeight),p.options.enableCanvasResize&&(window.addEventListener("resize",p.resizeCanvas.bind(p)),window.addEventListener("orientation",p.resizeCanvas.bind(p)),p.resizeCanvas()),p}let o,a,s;var u={width:32,height:32,originX:0,originY:0,images:[{x:0,y:0,t:[.0625,0,0,0,.0625,0,0,0,1]}]},l={width:32,height:32,originX:0,originY:0,images:[{x:32,y:0,t:[.0625,0,0,0,.0625,0,.0625,0,1]}]},c={width:32,height:32,originX:0,originY:0,images:[{x:64,y:0,t:[.0625,0,0,0,.0625,0,.125,0,1]}]},d={width:16,height:16,originX:0,originY:0,images:[{x:96,y:0,t:[.03125,0,0,0,.03125,0,.1875,0,1]},{x:128,y:0,t:[.03125,0,0,0,.03125,0,.25,0,1]},{x:160,y:0,t:[.03125,0,0,0,.03125,0,.3125,0,1]},{x:192,y:0,t:[.03125,0,0,0,.03125,0,.375,0,1]},{x:224,y:0,t:[.03125,0,0,0,.03125,0,.4375,0,1]},{x:256,y:0,t:[.03125,0,0,0,.03125,0,.5,0,1]}]};function m(e,t){for(var i=[],r=1/e,n=1/t,o=0;o<1;o+=r)for(var a=0;a<1;a+=n){var s=o+r,u=a+n;i.push(o,a,o,u,s,u,s,u,s,a,o,a)}return i}var h={unit:m(1,1),four:m(4,4),eight:m(8,8),sixteen:m(16,16),screen:m(50,30)};o=n({glOptions:{antialias:!1},contextImageSmoothing:!1,responsive:"scale",maintainAspectRatio:!0,scalePerfectly:!0,gameTextureParameters:{textureMagFilter:"nearest",textureMinFilter:"nearest"},mainShaderOptions:{source:{vertex:"#version 300 es\n#define shockwave_count 3\nin vec2 a_position;in vec2 a_texture;out vec2 v_texcoord;uniform mat3 u_position_matrix;uniform mat3 u_texture_matrix;uniform int u_use_shockwave;uniform vec3 u_shockwave[2*shockwave_count];uniform vec2 u_surfaceSize;void main(){vec2 vertex=a_position;if(u_use_shockwave==1){for(int s=0;s<2*shockwave_count;s+=2){float current_time=u_shockwave[s+1].y;if(current_time>0.0){vec2 epicenter=vec2(u_shockwave[s].x/u_surfaceSize.x,u_shockwave[s].y/u_surfaceSize.y);float dist=distance(vertex,epicenter);float max_radius=u_shockwave[s+1].x/min(u_surfaceSize.x,u_surfaceSize.y);if(dist<max_radius){float max_time=u_shockwave[s+1].z;float progress=current_time/max_time;float intensity=u_shockwave[s].z;float wave=progress*max_radius;float shock=intensity*(1.0-progress)*(max_radius-abs(wave-dist))/max_radius;float theta=atan(epicenter.y-vertex.y,epicenter.x-vertex.x);vertex-=vec2(shock*cos(theta),shock*sin(theta));}}}}gl_Position=vec4((u_position_matrix*vec3(vertex,1.0)).xy,0,1);v_texcoord=(u_texture_matrix*vec3(a_texture,1.0)).xy;}",fragment:"#version 300 es\nprecision mediump float;in vec2 v_texcoord;out vec4 output_color;uniform sampler2D u_atlas;uniform vec4 u_blend;uniform int u_use_texture;uniform sampler2D u_palette;uniform int u_palette_index;uniform int u_monochrome;uniform vec3 u_monochrome_multiplier;void main(){if(u_use_texture==0){output_color=u_blend;}else{vec4 color=texture(u_atlas,v_texcoord);if(u_palette_index>0){for(int a=0;a<textureSize(u_palette,0).x;a++){if(color==texelFetch(u_palette,ivec2(a,0),0)){color=texelFetch(u_palette,ivec2(a,u_palette_index),0);break;}}}if(u_monochrome==1){float average=(color.r+color.g+color.b)/3.0;color=vec4(vec3(average*u_monochrome_multiplier),color.a);}output_color=color*u_blend;}}"},attributes:{position:"a_position",texture:"a_texture"},uniforms:{atlas:"u_atlas",blend:"u_blend",positionMatrix:"u_position_matrix",textureMatrix:"u_texture_matrix",useTexture:"u_use_texture"}}}),a=o.main,s=o.draw;var f=o.gl;a.uniforms.paletteIndex=f.getUniformLocation(a.program,"u_palette_index"),a.uniforms.paletteSampler=f.getUniformLocation(a.program,"u_palette"),a.uniforms.monochrome=f.getUniformLocation(a.program,"u_monochrome"),a.uniforms.monochromeMultiplier=f.getUniformLocation(a.program,"u_monochrome_multiplier"),a.uniforms.useShockwave=f.getUniformLocation(a.program,"u_use_shockwave"),a.uniforms.shockwave=f.getUniformLocation(a.program,"u_shockwave"),a.uniforms.surfaceSize=f.getUniformLocation(a.program,"u_surfaceSize");var x=[112,80,.05,25,0,30,192,80,.08,25,0,20,272,80,.03,25,0,60];function v(){o.beginRender(),s.text(8,12,"Palette Swaps:"),s.spriteSpeed(d,.2,80,8),f.uniform1i(a.uniforms.paletteIndex,1),s.spriteSpeed(d,.2,112,8),f.uniform1i(a.uniforms.paletteIndex,2),s.spriteSpeed(d,.2,144,8),f.uniform1i(a.uniforms.paletteIndex,0),s.text(8,32,"Monochrome:"),f.uniform1i(a.uniforms.monochrome,1),f.uniform3f(a.uniforms.monochromeMultiplier,.8,.8,.8),s.spriteSpeed(d,.2,80,28),f.uniform3f(a.uniforms.monochromeMultiplier,1.25,.75,.75),s.spriteSpeed(d,.2,112,28),f.uniform3f(a.uniforms.monochromeMultiplier,.75,1.25,.75),s.spriteSpeed(d,.2,144,28),f.uniform3f(a.uniforms.monochromeMultiplier,.75,.75,1.25),s.spriteSpeed(d,.2,176,28),f.uniform3f(a.uniforms.monochromeMultiplier,0,1,1),s.spriteSpeed(d,.2,208,28),f.uniform3f(a.uniforms.monochromeMultiplier,1,0,1),s.spriteSpeed(d,.2,240,28),f.uniform3f(a.uniforms.monochromeMultiplier,1,1,0),s.spriteSpeed(d,.2,272,28),f.uniform1i(a.uniforms.monochrome,0),s.text(8,56,"Shockwaves:"),s.sprite(u,0,80,48),s.sprite(u,0,112,48),s.sprite(u,0,80,80),s.sprite(u,0,112,80),s.sprite(l,0,160,48),s.sprite(l,0,192,48),s.sprite(l,0,160,80),s.sprite(l,0,192,80),s.sprite(c,0,240,48),s.sprite(c,0,272,48),s.sprite(c,0,240,80),s.sprite(c,0,272,80);for(var e=0;e<x.length;e+=6)x[e+4]++,x[e+4]>x[e+5]&&(x[e+4]=-30);f.uniform3fv(a.uniforms.shockwave,x),f.uniform2f(a.uniforms.surfaceSize,o.viewWidth,o.viewHeight),f.uniform1i(a.uniforms.useShockwave,1),o.endRender(null,h.screen,h.screen),f.uniform1i(a.uniforms.useShockwave,0),requestAnimationFrame(v)}Promise.all([o.loadTexture("build/atlas.png",{textureMagFilter:"nearest",textureMinFilter:"nearest"}),o.loadTexture("build/palette.png",{textureMagFilter:"nearest",textureMinFilter:"nearest"})]).then((function(e){var t=e[0],i=e[1];o.setAtlas(t),f.uniform1i(a.uniforms.paletteSampler,1),f.uniform1i(a.uniforms.paletteIndex,0),f.activeTexture(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,i.texture),f.activeTexture(f.TEXTURE0),v()})).catch(console.error);
